---
title: Troubleshoot HTTP Errors in IIS
description: Provides troubleshooting steps for resolving 4xx and 5xx HTTP status code errors in Internet Information Services (IIS).
ms.date: 01/09/2025
ms.reviewer: khgupta, v-sidong
ms.custom: sap:Site Behavior and Performance\Runtime errors and exceptions, including HTTP 400 and 50x errors
---
# Troubleshoot 4xx and 5xx HTTP errors

This article provides troubleshooting steps for resolving 4xx and 5xx HTTP status code errors in Internet Information Services (IIS). These errors can indicate issues on the client or server side. The guidance will help you identify the cause of these errors and resolve them effectively.

## Identify 4xx errors

4xx HTTP status codes indicate that an error has occurred due to a client-side issue. For example, the client browser might have requested a page without providing valid authentication information.

To identify 4xx errors, see the IIS logs and HTTPERR logs:

- The HTTP status code is recorded in the IIS logs. This file is usually stored in **c:\inetpub\logs\Logfiles** but can be configured via IIS **Logging** in IIS Manager.
- A 4xx error code can be generated by the **HTTP.sys** kernel driver, meaning these requests might not reach IIS and thus won't be logged in IIS logs. **HTTP.sys** logs these errors in separate files called [HTTPERR logs](/windows/win32/http/error-logging-in-the-http-server-api). This file is usually stored in **C:\windows\system32\LogFiles\HTTPERR** but can be configured via the registry **HKEY\LOCAL\MACHINE\System\CurrentControlSet\Services\HTTP\Parameters\ErrorLoggingDir**.
- One way to confirm if 4xx response is coming from **HTTP.sys** is to collect an HAR trace on the client and look for response header **Microsoft-HttpApi/2.0**.

  To capture a HAR file, which records your browser's interaction with the website, follow the instructions in [Capture a browser trace for troubleshooting](/azure/azure-portal/capture-browser-trace#microsoft-edge).

### Examine IIS logs

If you find the error in the IIS logs, note down the status code (sc-status) and sub status code (sc-substatus) and see [HTTP status code overview](../health-diagnostic-performance/http-status-code.md#4xx---client-error) for more information.

To get additional information on the status code and to understand which module or handler returned 4xx errors, collect [Failed Request Trace (FREB) logs](#steps-to-capture-freb-logs) around the time of the issue occurred by configuring a FREB rule to trigger by the status code seen in the IIS logs.

### Examine HTTPERR logs

If you find the error in the HTTPERR logs, note down the reason (s-reason) and see [Types of Errors Logged by the HTTP Server API](/windows/win32/http/types-of-errors-logged-by-the-http-server-api) for more information.

## Identify 5xx errors

5xx HTTP status codes indicate that the server can't complete the request because the server encounters an error when processing the request. Use the following instructions based on your application type.

### Classic ASP: 500 error

If any error occurs in classic ASP, check the error code or the error message in the `cs-uri-query` of IIS logs.

For more information, capture and examine [Failed Request Trace (FREB) logs](#steps-to-capture-freb-logs) for the 500 errors.

### General IIS: 500 error

Examine IIS logs, note down sc-status and sc-substatus and look for the status code in [HTTP status code overview](../health-diagnostic-performance/http-status-code.md#5xx---server-error) for more information on the failure.

Enable detailed error messages if feasible to get more details.

To enable detailed error messages, follow these steps:

1. Open **Run** command window.
1. Launch **inetmgr**.
1. In the IIS Manager, under **Connections** pane located on the left side of the console, expand the machine name, expand **Sites**, and then select the target website.

   :::image type="content" source="media/troubleshoot-http-error-code/iis-connection-site-target-website.png" alt-text="Screenshot of target website in IIS manager.":::

1. Double click **Error Pages** icon in the middle pane.

   :::image type="content" source="media/troubleshoot-http-error-code/error-pages-icon.png" alt-text="Screenshot of error pages icon.":::

1. On the right, in the **Actions** pane, select **Edit Feature Settings...**.

   :::image type="content" source="media/troubleshoot-http-error-code/edit-feature-settings.png" alt-text="Screenshot of edit feature settings.":::

1. In the **Edit Error Pages Settings** dialog, where you choose to send for both local and remote requests, the second option button is what needs to be selected to have the detailed errors returned for both local and remote requests; the bottom option is what is on by default where detailed error messages are only sent for local requests.

   :::image type="content" source="media/troubleshoot-http-error-code/edit-error-pages-settings.png" alt-text="Screenshot of edit error pages settings dialog.":::

   We don't recommended that you send detailed errors for remote requests since this could expose sensitive information to the Internet, we need to revert the changes once we get more information on the failure.

For more information, capture and examine [Failed Request Trace (FREB) logs](#steps-to-capture-freb-logs) for the 500 errors.

### ASP.NET: 500 error

- Check Application Event Logs

  Check the Application Event Logs around the time the issue occurred. ASP.NET will log details of the error, including the call stack, in the Application Event Logs.

- Capture memory dumps

  In some cases, it might be necessary to capture a memory dump on the specific exception to examine details surrounding the exception that caused the 500 HTTP status.

  To capture dumps, follow instructions in the following article:

  [Collect memory dumps for a first-chance exception, when it occurs - Microsoft Community Hub](https://techcommunity.microsoft.com/t5/iis-support-blog/collect-memory-dumps-for-a-first-chance-exception-when-it-occurs/ba-p/2276128)

  Use the DebugDiag 2 Analysis tool (part of the [DebugDiag](https://www.microsoft.com/download/details.aspx?id=58210&msockid=145197b7d1fa6877376482b2d0bf6961) suite) with the **CrashHangAnalysis** rule on the dumps collected to generate a report which can be used to review the call stack and identify the root cause.

  To generate a report using the DebugDiag Analysis tool, follow these steps:

  1. Open DebugDiag 2 Analysis.
  1. Select **Add Data Files** and add the **.dmp** file(s).
  1. Select **CrashHangAnalysis** and **PerfAnalysis** and select **Start Analysis**.

  When finished, a report (**.mht**) will be created in **C:\Program Files\DebugDiag\Reports** and displayed in Internet Explorer with the results and recommendations.

  If using custom DLLs, you can specify the Symbol Search Path to the custom PDB files by following these steps:

  1. Open the DebugDiag 2 Collection tool.
  1. Select **Tools** > **Options And Settings...** > **Folders And Search Paths**.
  1. Under **Symbol Search Path For Debugging**, select **Browse...** to set the path.

- Exceeding ASP.NET ExecutionTimeout

  For 500 errors due to exceeding ASP.NET ExecutionTimeout, [capture PerfView trace and dumps](#steps-to-capture-perfview-trace-and-dumps) to identify any delays.

### ASP.NET Core: 500 errors

- Check Application Event Logs

  To access the Application Event Logs, follow these stepsï¼š

  1. Open the **Start** menu, search for **Event Viewer**, and select **Event Viewer**.
  1. In **Event Viewer**, open the **Windows Logs** node.
  1. Select **Application** to open the Application Event Logs.
  1. Search for errors associated with the failing app. Errors have a value of **IIS AspNetCore Module** or **IIS Express AspNetCore Module** in the **Source** column.

- Enable the Developer Exception Page

  The `ASPNETCORE\_ENVIRONMENT` [environment variable can be added to web.config](/aspnet/core/host-and-deploy/aspnet-core-module#setting-environment-variables) to run the application in the development environment. As long as the environment isn't overridden in application startup by UseEnvironment on the host builder, setting the environment variable allows the [Developer Exception Page](/aspnet/core/fundamentals/error-handling) to appear when the application is run.

  ```xml
  <aspNetCore processPath="dotnet"
      arguments=".\MyApp.dll"
      stdoutLogEnabled="false"
      stdoutLogFile=".\logs\stdout"
      hostingModel="InProcess">
    <environmentVariables>
       <environmentVariable name="ASPNETCORE\_ENVIRONMENT" value="Development" />
    </environmentVariables>
  </aspNetCore>
  ```

  Setting the environment variable for `ASPNETCORE\_ENVIRONMENT` is only recommended for use on staging and testing servers that aren't exposed to the Internet. Remove the environment variable from the **web.config** file after troubleshooting.

- Enable ASP.NET Core Module stdout log

  To enable and view stdout logs, follow these steps:

  1. Navigate to the site's deployment folder on the hosting system.
  1. If the **logs** folder isn't present, create the folder. For instructions on how to enable MSBuild to create the **logs** folder in the deployment automatically, see [Directory structure](/aspnet/core/host-and-deploy/directory-structure).
  1. Edit the **web.config** file. Set `stdoutLogEnabled` to `true` and change the `stdoutLogFile` path to point to the **logs** folder (for example, **.\logs\stdout**) like the following one:

     ```xml
     <aspNetCore processPath="dotnet"
         arguments=".\App.dll"
         stdoutLogEnabled="true"
         stdoutLogFile=".\logs\stdout">
     </aspNetCore>
     ```

  1. `stdout` in the path is the log file name prefix. A timestamp, process id, and file extension are added automatically when the log is created. Using `stdout` as the file name prefix, a typical log file is named **stdout\_20180205184032\_5412.log**.
  1. Ensure your application pool's identity has write permissions to the **logs** folder.
  1. Save the updated **web.config** file.
  1. Make a request to the application.
  1. Navigate to the **logs** folder. Find and open the most recent `stdout` log.
  1. Study the log for errors.

  To disable `stdout` logging when troubleshooting is complete, follow these steps:

  1. Edit the **web.config** file.
  1. Set `stdoutLogEnabled` to `false`.
  1. Save the file.

- Enable ASP.NET Core Module debug log (IIS)

  To enable ASP.NET Core Module debug log, add the following handler settings to the application's **web.config** file :

  ```xml
  <aspNetCore ...>
     <handlerSettings>
       <handlerSetting name="debugLevel" value="file" />
       <handlerSetting name="debugFile" value="c:\temp\ancm.log" />
     </handlerSettings>
  </aspNetCore>
  ```

  Confirm that the path specified for the log exists and that the app pool's identity has write permissions to the location.

### ARR: 502 error

Follow the instructions in [Troubleshooting 502 errors in ARR - Internet Information Services | Microsoft Learn](../application-request-routing/troubleshooting-502-errors-in-arr.md).

### 503 error

You can find 503 errors in either IIS Logs or HTTPERR logs. Any `sc-substatus` in IIS logs or `s-reason` in HTTPERR logs could provide some hints.

For more information, see:

- [503 - Service unavailable](../health-diagnostic-performance/http-status-code.md#503---service-unavailable).
- [Error Logging in the HTTP Server API](/windows/win32/http/error-logging-in-the-http-server-api#kinds-of-errors-that-the-http-api-logs)

Also refer to the following article which highlights a known issue that can cause 503 errors:

[HTTP response 503 Service Unavailable from IIS: one common generic cause](https://techcommunity.microsoft.com/t5/iis-support-blog/http-response-503-service-unavailable-from-iis-one-common/ba-p/1720007)

## Data collection

### Steps to capture FREB logs

> [!IMPORTANT]
> To configure FREB logs, make sure the **Tracing** role service is installed for IIS.

To install the **Tracing** role service for IIS, follow these steps:

[!INCLUDE [Install the Tracing role service](../../../../includes/enable-tracing-role.md)]

Once the **Tracing** role service is installed, follow these steps to capture FREB:

1. Open the **Run** command window.
1. Launch **inetmgr**.
1. In IIS Manager, under the **Connections** pane, expand the machine name, expand **Sites**, and then select the target website.

   :::image type="content" source="media/troubleshoot-http-error-code/iis-connection-site-target-website.png" alt-text="Screenshot of target website in IIS manager.":::

1. Double-click **Failed Request Tracing Rules**.

   :::image type="content" source="media/troubleshoot-http-error-code/default-web-site-home.png" alt-text="Screenshot of Default Web Site Home.":::

1. Select **Finish**.
1. In the **Actions** pane, select **Add...**.
1. In the **Add Failed Request Tracing Rule** wizard, on the **Specify Content to Trace** page, select **All Content** > **Next**.

   :::image type="content" source="media/troubleshoot-http-error-code/add-failed-request-tracing-rule.png" alt-text="Screenshot of Specify Content to Trace in the Add Failed Request Tracing Rule window.":::

1. On the **Define Trace Conditions** page, update the field of **Status code(s)** to **400-600** and select **Next**.

   :::image type="content" source="media/troubleshoot-http-error-code/define-trace-conditions.png" alt-text="Screenshot of Define Trace Conditions.":::

1. On the **Select Trace Providers** page, under **Providers**, select the all the checkboxes. Under **Areas**, make sure all the checkboxes are selected for each provider. Under **Verbosity**, select **Verbose**. Select **Finish**.

   :::image type="content" source="media/troubleshoot-http-error-code/select-trace-providers.png" alt-text="Screenshot of Select Trace Providers in the Add Failed Tracing Rule dialog.":::

1. Enable **Failed Request Tracing** for the site and configure the Log File Directory:

   1. In the **Connections** pane, expand the machine name, expand **Sites**, and then select **Default Web Site**.
   1. In the **Actions** pane, under **Configure**, select **Failed Request Tracing**.

      :::image type="content" source="media/troubleshoot-http-error-code/configure-failed-request-tracing.png" alt-text="Screenshot of Failed Request Tracing.":::

   1. In the **Edit Web Site Failed Request Tracing Settings** dialog box, select the **Enable** checkbox, set the field of **Directory** to **%SystemDrive%\inetpub\logs\FailedReqLogFiles**, and set **Maximum number of trace files** to **1000**.

      :::image type="content" source="media/troubleshoot-http-error-code/edit-website-failed-request-tracing-settings.png" alt-text="Screenshot of the Edit Web Site Failed Request Tracing Settings window.":::

   1. Select **OK**.

### Steps to capture PerfView trace and dumps

To capture a PerfView trace and dumps, follow the steps in the following sections.

#### Before the issue occurs

1. Download [Procdump](/sysinternals/downloads/procdump). It's a lightweight executable file that doesn't require installation and automates dump collection.
1. Extract the **procdump.exe** to a particular folder on the server.
1. Download the [PerfView](https://github.com/microsoft/perfview/releases) tool on the server. It's a profiler tool that captures ETW events (no installation required).
1. For PerfView to provide useful information, add **Tracing** as a **Role Service** for IIS. Without **Tracing** enabled, an ETW trace will only include **HTTP.sys** information. If you aren't sure whether the Tracing role service is installed, follow these steps:

   [!INCLUDE [Note when using Procdump](../../../../includes/enable-tracing-role.md)]

1. Open the PerfView tool, select the **Collect** menu, and select the **Collect** option.
1. Select the **Zip**, **Merge**, and **Thread Time** checkbox as the following screenshot. Modify the field of **Circular MB** to **2000**:

   :::image type="content" source="media/troubleshoot-http-error-code/zip-merge-thread-time.png" alt-text="Screenshot of selecting Zip, Merge, and Thread Time.":::

1. Expand the **Advanced Options** tab and select the **IIS** checkbox as the following screenshot.

   :::image type="content" source="media/troubleshoot-http-error-code/collecting-data-over-user-specified-interval.png" alt-text="Screenshot of collecting data over a user specified interval.":::

   If you're running an ASP.NET Core application, add the following string in the **Additional Providers**:

   `*Microsoft-Extensions-Logging:4:5,Microsoft-AspNetCore-Server-Kestrel,System.Net.Http,System.Net.Sockets,System.Net.NameResolution,System.Threading.Tasks.TplEventSource::5,Microsoft-System-Net-Http,Microsoft-Windows-Application Server-Applications::Verbose`

   > [!NOTE]
   > Don't miss `*` at the beginning.

#### During the time of issue

1. Select the **Start Collection** button in PerfView with the configuration settings you previously set up.
1. Open Internet Information Services (IIS) Manager.
1. Select your server name (on the left).
1. Double-click **Worker Processes** to see **Process Id** of the Services. For example:

   :::image type="content" source="media/troubleshoot-http-error-code/worker-processes.png" alt-text="Screenshot of Worker Processes in IIS Manager.":::

1. Open **Command Prompt** as an administrator.
1. Navigate to the folder where **procdump.exe** is extracted by running `cd <path to procdump.exe>` in the **Command Prompt** window.
1. Run the following command to capture consecutive dumps.

   `procdump.exe -accepteula -ma <PID of W3WP.exe)> -s 10 -n 3`

   > [!NOTE]
   > Replace `<PID of W3WP.exe>` with the actual PID of the **W3WP.exe** process you found in step 4.

   - You can specify a path at the end of the command to store the dumps in a specific location.
   - This command will capture 3 sets of dumps at 10-second intervals.

1. Once the dumps are collected by procdump, stop PerfView by selecting **Stop collection**, or wait for 2.5 minutes for it to stop automatically. Allow PerfView to merge the collected data, which may take some time. And it will generate a **Perfview.etl.zip** file. If you get prompt for symbols, select **Use Microsoft Symbol Servers**.

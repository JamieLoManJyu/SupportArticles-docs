---
title: Troubleshoot HTTP Errors in IIS
description: Describes the troubleshooting steps to identify the cause of various HTTP 400 errors when using IIS.
ms.date: 01/09/2025
ms.reviewer: 
ms.custom: sap:Site Behavior and Performance\Runtime errors and exceptions, including HTTP 400 and 50x errors
---
# Troubleshoot 4xx and 5xx HTTP errors

This article provides troubleshooting steps for resolving 4xx and 5xx HTTP status code errors in Internet Information Services (IIS). These errors can indicate issues on the client or server side. The guidance will help you identify the cause of these errors and resolve them effectively.

## Identify 4xx errors

4xx HTTP status codes indicate that an error has occurred due to a client-side issue. For example, the client browser might have requested a page without providing valid authentication information.

To identify 4xx errors, see the IIS logS and HTTPERR logs:

- The HTTP status code is recorded in the IIS logs. This file is usually stored in **c:\inetpub\logs\Logfiles** but can be configured via IIS **Logging** in IIS Manager.
- A 4xx error code can be generated by the **HTTP.sys** kernel driver, meaning these requests might not reach IIS and thus won't be logged in IIS logs. **HTTP.sys** logs these errors in separate files called [HTTPERR logs](/windows/win32/http/error-logging-in-the-http-server-api). This file is usually stored in **C:\windows\system32\LogFiles\HTTPERR** but can be configured via registry **HKEY\LOCAL\MACHINE\System\CurrentControlSet\Services\HTTP\Parameters\ErrorLoggingDir**.
- One way to confirm if 4xx response is coming from **HTTP.sys** is to collect an HAR trace on the client and look for response header **Microsoft-HttpApi/2.0**.

  To capture a HAR file, which records your browser's interaction with the website, follow the instructions in [Capture a browser trace for troubleshooting](/azure/azure-portal/capture-browser-trace#microsoft-edge).

### Examine IIS logs

If you find the error in the IIS logs, note down the status code (sc-status) and sub status code (sc-substatus) and see [HTTP status code overview](../health-diagnostic-performance/http-status-code.md#4xx---client-error) for more information.

To get additional information on the status code and to understand which module or handler returned 4xx errors, collect [Failed Request Trace (FREB) logs](#steps-to-capture-freb-logs) around the time of the issue occurred by configuring a FREB rule to trigger by the status code seen in the IIS logs.

### Examine HTTPERR logs

If you find the error in the HTTPERR logs, note down the reason (s-reason) and see [Types of Errors Logged by the HTTP Server API](/windows/win32/http/types-of-errors-logged-by-the-http-server-api) for more information.

## Identify 5xx errors

5xx HTTP status codes indicate that the server can't complete the request because the server encounters an error when processing the request. Follow the following instructions based on your application type.

### Classic ASP: 500 error

If any error occurs in classic ASP, check the error code or the error message in the `cs-uri-query` of IIS logs.

For more information, capture and examine [Failed Request Trace (FREB) logs](#steps-to-capture-freb-logs) for the 500 errors.

### General IIS: 500 Error

Examine IIS logs, note down sc-status and sc-substatus and look for the status code in [HTTP status code overview](../health-diagnostic-performance/http-status-code.md#5xx---server-error) for more information on the failure.

Enable detailed error messages if feasible to get more details.

To enable detailed error messages, follow these steps:

1. Open **Run** command window.
1. Launch **inetmgr**.
1. In the IIS Manager, under **Connections** pane located on the left side of the console, expand the machine name, expand **Sites**, and then select the target website.

   :::image type="content" source="media/troubleshoot-http-error-code/iis-connection-site-target-website.png" alt-text="Screenshot of target website in IIS manager.":::

1. Double click **Error Pages** icon in the middle pane.

   :::image type="content" source="media/troubleshoot-http-error-code/error-pages-icon.png" alt-text="Screenshot of error pages icon.":::

1. On the right, in the actions pane, select **Edit Feature Settings...**.

   :::image type="content" source="media/troubleshoot-http-error-code/edit-feature-settings.png" alt-text="Screenshot of edit feature settings.":::

1. In the **Edit Error Pages Settings** dialog, where you choose to send for both local and remote requests. The second option button is what needs to be selected to have the detailed errors returned for both local and remote requests. The bottom option is what is on by default where detailed error messages are only sent for local requests.

   :::image type="content" source="media/troubleshoot-http-error-code/edit-error-pages-settings.png" alt-text="Screenshot of edit error pages settings dialog.":::

We don't recommended that you send detailed errors for remote requests since this could expose sensitive information to the Internet, we need to revert the changes once we get more information on the failure.

* For more information, capture and examine Failed Request Trace (FREB) logs for the 500 errors.

ASP.NET: 500 Error

* **Check Application Event Logs**:
* Check the application event logs around the time the issue occurred. ASP.NET will log details of the error, including the call stack, in the application event log.

* **Capture Memory Dump**:
* In some cases, it may be necessary to capture a memory dump on the specific exception to examine details surrounding the exception that caused the 500 HTTP status.
* To capture dumps, follow instructions in article below

[Collect memory dumps for a first-chance exception, when it occurs - Microsoft Community Hub](https://techcommunity.microsoft.com/t5/iis-support-blog/collect-memory-dumps-for-a-first-chance-exception-when-it-occurs/ba-p/2276128)

* Use the DebugDiag 2 Analysis tool (part of the DebugDiag suite) with the CrashHangAnalysis rule on the dumps collected to generate a report which can be used to review the call stack and identify the root cause.

Follow below instructions to generate a report using DebugDiag Analysis Tool

* Open DebugDiag 2 Analysis
* Click Add Data Files and add the .dmp file(s).
* Select the Crash/Hang Analyzers & "Performance Analyzers" scripts and click Start Analysis.

When finished, a report (.mht) will be created in C:\Program Files\DebugDiag\Reports and displayed in Internet Explorer with the results and recommendations.

If using custom DLLs, the Symbol path (Tools menu -> Options and Settings -> Symbol Search Path) to the custom PDB files can be added.

* **Exceeding ASP.NET ExecutionTimeout**:
* For 500 errors due to exceeding ASP.NET ExecutionTimeout, capture perfview and dumps to identify any delays.

ASP.NET Core: 500 Errors

* **Check Application Event Logs:**
* Access the Application Event Log:

1. Open the Start menu, search for *Event Viewer*, and select the **Event Viewer** app.
2. In **Event Viewer**, open the **Windows Logs** node.
3. Select **Application** to open the Application Event Log.
4. Search for errors associated with the failing app. Errors have a value of *IIS AspNetCore Module* or *IIS Express AspNetCore Module* in the *Source* column.

* **Enable the Developer Exception Page:**

The ASPNETCORE\_ENVIRONMENT [environment variable can be added to web.config](https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/aspnet-core-module?view=aspnetcore-8.0#setting-environment-variables) to run the app in the Development environment. As long as the environment isn't overridden in app startup by UseEnvironment on the host builder, setting the environment variable allows the [Developer Exception Page](https://learn.microsoft.com/en-us/aspnet/core/fundamentals/error-handling?view=aspnetcore-8.0) to appear when the app is run.

<aspNetCore processPath="dotnet"

arguments=".\MyApp.dll"

stdoutLogEnabled="false"

stdoutLogFile=".\logs\stdout"

hostingModel="InProcess">

<environmentVariables>

<environmentVariable name="ASPNETCORE\_ENVIRONMENT" value="Development" />

</environmentVariables>

</aspNetCore>

Setting the environment variable for ASPNETCORE\_ENVIRONMENT is only recommended for use on staging and testing servers that aren't exposed to the Internet. Remove the environment variable from the *web.config* file after troubleshooting.

* **Enable ASP.NET Core Module stdout log**

To enable and view stdout logs:

1. Navigate to the site's deployment folder on the hosting system.
2. If the *logs* folder isn't present, create the folder. For instructions on how to enable MSBuild to create the *logs* folder in the deployment automatically, see the [Directory structure](https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/directory-structure?view=aspnetcore-8.0) topic.
3. Edit the *web.config* file. Set **stdoutLogEnabled** to true and change the **stdoutLogFile** path to point to the *logs* folder (for example, .\logs\stdout) like below.

<aspNetCore processPath="dotnet"
    arguments=".\App.dll"
    stdoutLogEnabled="true"
    stdoutLogFile=".\logs\stdout">
</aspNetCore>

1. stdout in the path is the log file name prefix. A timestamp, process id, and file extension are added automatically when the log is created. Using stdout as the file name prefix, a typical log file is named *stdout\_20180205184032\_5412.log*.
2. Ensure your application pool's identity has write permissions to the *logs* folder.
3. Save the updated *web.config* file.
4. Make a request to the app.
5. Navigate to the *logs* folder. Find and open the most recent stdout log.
6. Study the log for errors.

Disable stdout logging when troubleshooting is complete:

1. Edit the *web.config* file.
2. Set **stdoutLogEnabled** to false.
3. Save the file.

* **Enable ASP.NET Core Module debug log (IIS)**

Add the following handler settings to the app's web.config file to enable ASP.NET Core Module debug log:

<aspNetCore ...>

<handlerSettings>

<handlerSetting name="debugLevel" value="file" />

<handlerSetting name="debugFile" value="c:\temp\ancm.log" />

</handlerSettings>

</aspNetCore>

Confirm that the path specified for the log exists and that the app pool's identity has write permissions to the location.

ARR: 502 Error

Follow the instructions in [Troubleshooting 502 errors in ARR - Internet Information Services | Microsoft Learn](https://learn.microsoft.com/en-us/troubleshoot/developer/webapps/iis/application-request-routing/troubleshooting-502-errors-in-arr)

503 error

You can find 503 errors in either IIS Logs or HTTPERR logs. Any "sc-substatus" in IIS logs or "s-reason" in HTTPERR logs could provide some hints.

Refer below articles for more information.

[https://docs.microsoft.com/en-us/troubleshoot/developer/webapps/iis/www-administration-management/http-status-code#:~:text=503 - Service%](https://docs.microsoft.com/en-us/troubleshoot/developer/webapps/iis/www-administration-management/http-status-code#:~:text=503%20-%20Service%) 20unavailable.

<https://docs.microsoft.com/en-us/troubleshoot/developer/webapps/aspnet/site-behavior-performance/error-logging-http-apis#kinds-of-errors-that-the-http-api-logs>

Also refer below article which highlights a known issue that can cause 503 errors:

[HTTP response 503 Service Unavailable from IIS: one common generic cause](https://techcommunity.microsoft.com/t5/iis-support-blog/http-response-503-service-unavailable-from-iis-one-common/ba-p/1720007)

## Data Collection

### Steps to capture FREB logs

To capture FREB, follow the instructions below:

Prerequisite: To configure FREB logs, we need "Tracing" added as a "Role Service" for IIS. Please confirm Tracing role is enabled if not please enabled it.

* Go to Server Manager -> Add Roles and Features -> Role-based or feature-based installation -> Select the destination server -> Server Roles
* Expand Web Server (IIS) -> Web Server -> Health and Diagnostics -> and check the Tracing checkbox
* Click Next for the subsequent steps and then Click **Install**

1. Once Tracing role is installed, Open Run command window (Ctrl + R).
2. Launch **inetmgr**.

3. In the IIS Manager, under **Connections** pane, expand the machine name, expand **Sites**, and then select the target website**.**

![A screenshot of a computer

Description automatically generated](data:image/png;base64...)

4. Double-click **Failed Request Tracing Rules**.

![undefined](data:image/jpeg;base64...)

5. Click **Finish**.

6. In the **Actions** pane, click **Add...**.

7. In the **Add Failed Request Tracing Rule** wizard, on the **Specify Content to Trace** page, select **All Content**. Click **Next**.

![undefined](data:image/jpeg;base64...)

8. On the **Define Trace Conditions** page, Status Code (400-600 ), click Next.

![undefined](data:image/jpeg;base64...)

9. Click **Next**.

10. On the **Select Trace Providers** page, under **Providers**, select the all the check boxes. Under **Areas**, make sure all the check boxes are selected for each provider. Under **Verbosity**, select **Verbose**.

![undefined](data:image/jpeg;base64...)

**Enable Failed-Request Tracing for the Site and Configure the Log File Directory**

1. In the **Connections** pane, expand the machine name, expand **Sites**, and then click **Default Web Site**.

2. In the **Actions** pane, under **Configure**, click **Failed Request Tracing�**.

![undefined](data:image/jpeg;base64...)

3. In the **Edit Web Site Failed Request Tracing Settings** dialog box, configure the following:

� Keep the defaults for the other settings.

![undefined](data:image/jpeg;base64...)

4. Click **OK**.

Steps to capture perfview trace and dumps

Please follow below instructions to capture a perfview trace and dumps

**Before the issue occurs:**

* Download Procdump from [ProcDump - Windows Sysinternals | Microsoft Docs](https://nam06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Fsysinternals%2Fdownloads%2Fprocdump&data=05%7C01%7Csainathreddy.gnv%40microsoft.com%7Cbd87b14ddbce4ccca21508dbd0ce189d%7C72f988bf86f141af91ab2d7cd011db47%7C1%7C0%7C638333355931074997%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=JERhOP0p3ohqAIm%2F7PasX%2BS0u6Fuo3%2Bm%2BMLHnELmJ1E%3D&reserved=0). It�s a lightweight executable (no installation required), that automates dump collection.
* Extract the procdump.exe to a particular folder on the Server.
* Please download the **Perfview tool** from [Releases � microsoft/perfview (github.com)](https://nam06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fperfview%2Freleases&data=05%7C01%7Csainathreddy.gnv%40microsoft.com%7Cbd87b14ddbce4ccca21508dbd0ce189d%7C72f988bf86f141af91ab2d7cd011db47%7C1%7C0%7C638333355931084951%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=UfTRG8MCyWK6%2B90VyBdYxvrylsw7gxbbAn2GnUloEIE%3D&reserved=0)on the Server. It�s a profiler tool that captures ETW events (no installation required).
* For PerfView to provide useful information, we need "Tracing" added as a "Role Service" for IIS. Without tracing enabled an ETW trace will only include HTTP.sys information. If you aren't sure whether this is installed follow these steps:
* Go to Server Manager -> Add Roles and Features -> Server Roles
* Expand Web Server (IIS) -> Web Server -> Health and Diagnostics -> and check the Tracing checkbox
* Click Next for the subsequent steps and then Click **Install**
* Open the Perfview tool and go to Collect Menu and select Collect option.
* Click Next for the subsequent steps and then Click **Install**
* Open the Perfview tool and go to Collect Menu and select Collect option.
* Select Zip, Merge, thread time check box as below. Modify the Circular MB to 2000:

![A screenshot of a computer

Description automatically generated](data:image/png;base64...)

* Expand the Advanced Options tab and select IIS checkbox as shown below.

If you are running an ASP.NET Core application, add the string below in the additional providers

**\*Microsoft-Extensions-Logging:4:5,Microsoft-AspNetCore-Server-Kestrel,System.Net.Http,System.Net.Sockets,System.Net.NameResolution,System.Threading.Tasks.TplEventSource::5,Microsoft-System-Net-Http,Microsoft-Windows-Application Server-Applications::Verbose** [Please do not miss **\*** at the beginning]

![A screenshot of a computer

Description automatically generated](data:image/png;base64...)

**During the time of issue:**

* Select �Start Collection� button in perfview with the configuration settings as mentioned before.
* Determine Process ID of the Services by clicking on Server Level in IIS Manager >> followed by going into �Worker Processes� feature. For ex:
* ![A screenshot of a computer

  Description automatically generated](data:image/png;base64...)

* Open command prompt as Administrator.
* Navigate to the folder where the procdump.exe is extracted in the command prompt (using **cd <path to procdump.exe>**).
* Run below command to capture consecutive dumps.

**procdump.exe -accepteula -ma <PID of W3WP.exe)> -s 10 -n 3**

* Appending path at the end of the command will store the dumps at respective location
* Above command will capture 3 sets of dumps at the interval of 10s. Please note that the dumps are timed, so we could hope to see the requests captured in it.
* Once the dumps are collected by procdump, stop Perfview by selecting �Stop collection�, **or it can be stopped after 2.5 minutes**. Allow it to Merge, it will take some time, and it will generate Perfview.etl.zip file. **If you get prompt for symbols, select �Use Microsoft Symbol Servers�.**
